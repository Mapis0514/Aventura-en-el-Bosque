<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aventura en el Bosque</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet">
    <style>
        /* --- NUEVO DISE√ëO DE BOSQUE CON RAMAS --- */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #f0f0f0;
            box-sizing: border-box;
            /* Fondo SVG con √°rboles y gradiente para una atm√≥sfera de bosque */
            background-color: #0a2d20;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100%' height='100%' viewBox='0 0 800 600'%3E%3Cdefs%3E%3CradialGradient id='g' cx='50%' cy='50%' r='50%'%3E%3Cstop offset='0%' style='stop-color:%232e604a;stop-opacity:1' /%3E%3Cstop offset='100%' style='stop-color:%230a2d20;stop-opacity:1' /%3E%3C/radialGradient%3E%3C/defs%3E%3Crect width='800' height='600' fill='url(%23g)' /%3E%3Cpath d='M-50 600 L 80 180 L 210 600 Z' fill='rgba(0,0,0,0.15)'/%3E%3Cpath d='M150 600 L 250 150 L 350 600 Z' fill='rgba(0,0,0,0.2)'/%3E%3Cpath d='M300 600 L 380 250 L 460 600 Z' fill='rgba(0,0,0,0.12)'/%3E%3Cpath d='M550 600 L 630 100 L 710 600 Z' fill='rgba(0,0,0,0.2)'/%3E%3Cpath d='M680 600 L 750 220 L 820 600 Z' fill='rgba(0,0,0,0.15)'/%3E%3C/svg%3E");
            background-size: cover;
            background-position: center;
        }
        
        .game-container {
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            text-align: center;
        }

        /* Estilos para el nuevo encabezado */
        .game-header {
            margin-bottom: 20px;
            position: relative;
            padding: 10px 80px;
        }

        .game-header h1 {
            font-family: 'Cinzel', serif;
            font-size: 3rem;
            color: #f5e5c5;
            text-shadow: 3px 3px 0px #4e342e, 5px 5px 10px rgba(0,0,0,0.7);
            margin: 0;
            line-height: 1;
        }

        /* Iconos de ramas en el t√≠tulo */
        .game-header::before, .game-header::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 70px;
            height: 90px;
            background-size: contain;
            background-repeat: no-repeat;
            transform: translateY(-50%);
            /* SVG de la rama, color caf√© url-encoded */
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 53 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M 50,95 C 40,80 60,70 50,60 C 40,50 60,40 50,30 C 40,20 60,10 50,5' stroke='%235D4037' stroke-width='8' fill='none' stroke-linecap='round'/%3E%3Cpath d='M 50,60 C 65,55 75,45 80,35' stroke='%235D4037' stroke-width='6' fill='none' stroke-linecap='round'/%3E%3Cpath d='M 50,45 C 35,50 25,60 20,70' stroke='%235D4037' stroke-width='6' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
        }

        .game-header::before {
            left: 0px;
        }

        .game-header::after {
            right: 0px;
            transform: translateY(-50%) scaleX(-1);
        }
        
        .video-wrapper {
            position: relative;
            width: 100%;
            max-width: 900px;
            max-height: calc(100vh - 340px); /* Ajustado para dar espacio al t√≠tulo */
            aspect-ratio: 16 / 9;
            overflow: hidden;
            border-radius: 10px;
            background-color: #000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            margin-bottom: 20px;
            border: 4px solid #5D4037; /* Borde de madera */
        }

        /* --- CAMBIO: ESTILO PARA LA ETIQUETA <video> --- */
        .video-wrapper video { 
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover; /* Asegura que el video cubra el √°rea */
        }
        /* --- FIN CAMBIO --- */
        
        #decision-container {
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            width: 100%;
            max-width: 900px;
            flex-shrink: 0;
        }

        .hidden {
            display: none;
        }
        
        /* Nuevo estilo de botones con ramas */
        .btn {
            position: relative; /* Necesario para posicionar las ramas */
            background: #f5e5c5; /* Color pergamino/madera clara */
            color: #5D4037; /* Letras caf√©s */
            border: 2px solid #4e342e;
            padding: 15px 55px; /* M√°s padding para dar espacio a las ramas */
            font-size: 16px;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            margin: 25px 10px; /* M√°s margen vertical */
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 7px 22px rgba(0, 0, 0, 0.6);
            background: #fffbf2;
        }

        /* Ramas SVG a√±adidas con pseudo-elementos */
        .btn::before, .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 45px;
            height: 60px;
            background-size: contain;
            background-repeat: no-repeat;
            transform: translateY(-50%);
            /* SVG de la rama, color caf√© url-encoded (%235D4037) */
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 53 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M 50,95 C 40,80 60,70 50,60 C 40,50 60,40 50,30 C 40,20 60,10 50,5' stroke='%235D4037' stroke-width='8' fill='none' stroke-linecap='round'/%3E%3Cpath d='M 50,60 C 65,55 75,45 80,35' stroke='%235D4037' stroke-width='6' fill='none' stroke-linecap='round'/%3E%3Cpath d='M 50,45 C 35,50 25,60 20,70' stroke='%235D4037' stroke-width='6' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
        }

        .btn::before {
            left: -25px;
        }

        .btn::after {
            right: -25px;
            transform: translateY(-50%) scaleX(-1); /* Refleja la rama horizontalmente */
        }


        #question-text {
            font-size: 24px;
            margin-bottom: 20px;
            color: #ffffff;
            font-weight: 300;
            text-shadow: 2px 2px 5px #000;
        }

        #buttons-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        /* Bot√≥n flotante para audio */
        .audio-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 20;
        }

        .btn-audio {
            background: rgba(0,0,0,0.55);
            border: 2px solid #f5e5c5;
            color: #f5e5c5;
            font-size: 24px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            transition: background .3s ease;
        }

        .btn-audio:hover {
            background: rgba(0,0,0,0.75);
        }

        .btn-audio:focus-visible {
            outline: 3px solid #fffbf2;
        }

        @media (min-width: 768px) {
            #buttons-container {
                flex-direction: row;
                flex-wrap: wrap;
            }
            .btn {
                font-size: 18px;
            }
        }
        @media (max-width: 768px) {
            .game-header h1 {
                font-size: 2rem;
            }
            .game-header::before, .game-header::after {
                width: 50px;
                height: 70px;
            }
        }
    </style>
</head>
<body>

<div class="game-container">
    
    <header class="game-header">
        <h1>Aventura en el Bosque</h1>
    </header>
    
    <div id="video-container" class="video-wrapper">
        <!-- CAMBIO: Usamos la etiqueta <video> para archivos locales -->
        <video id="videoPlayer" src="" autoplay muted playsinline></video>
        <div id="audioToggle" class="audio-toggle">
            <button id="audioBtn" class="btn-audio" aria-pressed="false" title="Activar sonido">üîá</button>
        </div>
    </div>

    <div id="decision-container" class="hidden">
        <h2 id="question-text"></h2>
        <div id="buttons-container">
        </div>
    </div>
</div>

<script>
    const story = {
        // CAMBIO: Se usa 'filename' en lugar de 'videoId' con la ruta relativa
        'Aparecebosque': {
            filename: 'escenasfinales/Aparecebosque2.MOV', // Asumiendo este es el archivo
            question: '¬øQu√© decisi√≥n tomas?',
            choices: [
                { text: 'Correr tras un guat√≠n', nextScene: 'Bosqueguatin' },
                { text: 'Bajar fruta de un √°rbol', nextScene: 'Arboljabali' }
            ]
        },
        'Bosqueguatin': {
            filename: 'escenasfinales/Guat√≠nbosque2.mp4', // Asumiendo que es el archivo 'Guatinbosque2.mp4'
            question: '¬øQu√© decisi√≥n tomas?',
            choices: [
                { text: 'Cubrirte con hojas de platano', nextScene: 'Platanooso' },
                { text: 'Construir un refugio', nextScene: 'Refugiocentauro' }
            ]
        },
        'Platanooso': {
            filename: 'escenasfinales/Platanooso2.mp4', // Asumiendo que es el archivo 'Platanooso2.mp4'
            question: '¬øQu√© decisi√≥n tomas?',
            choices: [
                { text: 'Quedarte quieto', nextScene: 'Quietoosofinal' },
                { text: 'Intentar escapar', nextScene: 'Escapeoso' }
            ]
        },
        'Refugiocentauro': {
            filename: 'escenasfinales/Refugiocentauro3.mp4', // Asumiendo que es el archivo 'Refugiocentauro3.mp4'
            question: '¬øQu√© decisi√≥n tomas?',
            choices: [
                { text: 'Hablar con el', nextScene: 'Centaurohabla' },
                { text: 'Me hago el muerto para que no me haga nada', nextScene: 'Mehagoelmuerto' }
            ]
        },
        'Arboljabali': {
            filename: 'escenasfinales/Arboljabali2.mp4', // Asumiendo que es el archivo 'Arboljabali2.mp4'
            question: '¬øQu√© decisi√≥n tomas?',
            choices: [
                { text: 'Subir a un √°rbol', nextScene: 'Arbolduende' },
                { text: 'Correr', nextScene: 'Correrjabali' }
            ]
        },
        'Arbolduende': {
            filename: 'escenasfinales/Arbolduende3.mp4', // Asumiendo que es el archivo 'Arbolduende3.mp4'
            question: '¬øQu√© decisi√≥n tomas?',
            choices: [
                { text: 'Poner una bomba y hu√≠r', nextScene: 'Bomba' },
                { text: 'Lo saludo, es amigable', nextScene: 'Duendeamigo' }
            ]
        },
        'Quietoosofinal': {
            filename: 'escenasfinales/quietoosofinal2.mp4',
            isEnd: true
        },
        'Escapeoso': {
            filename: 'escenasfinales/Escapeoso2.mp4',
            isEnd: true
        },
        'Centaurohabla': {
            filename: 'escenasfinales/Centaurohabla2.mp4',
            isEnd: true
        },
        'Mehagoelmuerto': {
            filename: 'escenasfinales/Mehagoelmuerto2.mp4',
            isEnd: true
        },
        'Bomba': {
            filename: 'escenasfinales/bomba2.mp4',
            isEnd: true
        },
        'Duendeamigo': {
            filename: 'escenasfinales/Duendeamigo2.mp4',
            isEnd: true
        },
        'Correrjabali': {
            filename: 'escenasfinales/Correrjabali2.mp4',
            isEnd: true
        }
    };
    
    // CAMBIO: Ahora es una etiqueta <video>
    const videoPlayer = document.getElementById('videoPlayer'); 
    const decisionContainer = document.getElementById('decision-container');
    const questionText = document.getElementById('question-text');
    const buttonsContainer = document.getElementById('buttons-container');
    const audioBtn = document.getElementById('audioBtn');

    // Estado persistente del usuario: si activ√≥ sonido
    let userUnmuted = false;

    function updateAudioButton() {
        audioBtn.textContent = videoPlayer.muted ? 'üîá' : 'üîä';
        audioBtn.title = videoPlayer.muted ? 'Activar sonido' : 'Silenciar';
        audioBtn.setAttribute('aria-pressed', (!videoPlayer.muted).toString());
    }

    audioBtn.addEventListener('click', () => {
        // Alternar mute
        videoPlayer.muted = !videoPlayer.muted;
        userUnmuted = !videoPlayer.muted; // Guardar preferencia
        // Forzar reproducci√≥n para que el cambio tome efecto (algunos navegadores requieren play tras cambiar mute)
        videoPlayer.play().catch(()=>{});
        updateAudioButton();
    });

    function showScene(sceneKey) {
        const scene = story[sceneKey];
        if (!scene) {
            console.error(`Error: La escena "${sceneKey}" no existe en la historia.`);
            return;
        }

        decisionContainer.classList.add('hidden');
        buttonsContainer.innerHTML = ''; 
        
        // --- INICIO: Manejo de listeners para evitar errores ---
        videoPlayer.onloadeddata = null; 
        videoPlayer.onerror = null; 
        // --- FIN: Manejo de listeners ---

        console.log(`Intentando cargar video: ${scene.filename}`); // Muestra la ruta en la consola

        videoPlayer.src = scene.filename;
        // Mantener preferencia del usuario entre escenas
        videoPlayer.muted = !userUnmuted; // si userUnmuted es true => muted false
        updateAudioButton();

        videoPlayer.load();
        videoPlayer.play().catch(error => {
            console.warn("Autoplay bloqueado (t√≠pico). Toca el video si no empieza a sonar.", error);
        });

        // 1. Mostrar decisiones cuando la primera data est√° cargada
        videoPlayer.onloadeddata = () => {
             console.log("Video cargado. Mostrando decisiones.");
             showDecisions(scene);
        };

        // 2. CAMBIO CR√çTICO: Fallback si el video falla al cargar (para que los botones aparezcan)
        videoPlayer.onerror = (event) => {
            console.error("ERROR CR√çTICO al cargar el video. La ruta podr√≠a ser incorrecta o el archivo no es accesible: " + scene.filename, event);
            // Si hay error, mostramos un mensaje y mostramos las decisiones de todas formas
            questionText.textContent = `[ERROR DE VIDEO: No se pudo cargar el archivo. ¬øDeseas continuar?] ${scene.question}`;
            showDecisions(scene); 
            videoPlayer.onloadeddata = null; // Evita que se dispare dos veces si se recupera
        };
    }
    
    function showDecisions(scene) {
        if (scene.isEnd) {
            questionText.textContent = 'Fin de esta ruta. ¬øQuieres intentarlo de nuevo?';
            const restartButton = document.createElement('button');
            restartButton.textContent = 'Volver a Empezar';
            restartButton.className = 'btn';
            restartButton.onclick = () => showScene('Aparecebosque');
            buttonsContainer.appendChild(restartButton);
        } else {
            // Solo actualiza el texto si no hubo un error de carga de video
            if (!questionText.textContent.includes('[ERROR DE VIDEO')) {
                questionText.textContent = scene.question;
            }
            
            scene.choices.forEach(choice => {
                const button = document.createElement('button');
                button.textContent = choice.text;
                button.className = 'btn';
                button.onclick = () => showScene(choice.nextScene);
                buttonsContainer.appendChild(button);
            });
        }
        
        decisionContainer.classList.remove('hidden');
    }
    
    showScene('Aparecebosque');
    updateAudioButton();

</script>

</body>
</html>