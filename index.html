<!DOCTYPE html> 
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aventura en el Bosque</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet">
    <style>
        /* --- NUEVO DISEÑO DE BOSQUE CON RAMAS maria paula --- */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #f0f0f0;
            box-sizing: border-box;
            /* Fondo SVG con árboles y gradiente para una atmósfera de bosque */
            background-color: #0a2d20;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100%' height='100%' viewBox='0 0 800 600'%3E%3Cdefs%3E%3CradialGradient id='g' cx='50%' cy='50%' r='50%'%3E%3Cstop offset='0%' style='stop-color:%232e604a;stop-opacity:1' /%3E%3Cstop offset='100%' style='stop-color:%230a2d20;stop-opacity:1' /%3E%3C/radialGradient%3E%3C/defs%3E%3Crect width='800' height='600' fill='url(%23g)' /%3E%3Cpath d='M-50 600 L 80 180 L 210 600 Z' fill='rgba(0,0,0,0.15)'/%3E%3Cpath d='M150 600 L 250 150 L 350 600 Z' fill='rgba(0,0,0,0.2)'/%3E%3Cpath d='M300 600 L 380 250 L 460 600 Z' fill='rgba(0,0,0,0.12)'/%3E%3Cpath d='M550 600 L 630 100 L 710 600 Z' fill='rgba(0,0,0,0.2)'/%3E%3Cpath d='M680 600 L 750 220 L 820 600 Z' fill='rgba(0,0,0,0.15)'/%3E%3C/svg%3E");
            background-size: cover;
            background-position: center;
        }
        
        .game-container {
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            text-align: center;
        }

        /* Estilos para el nuevo encabezado */
        .game-header {
            margin-bottom: 20px;
            position: relative;
            padding: 10px 80px;
        }

        .game-header h1 {
            font-family: 'Cinzel', serif;
            font-size: 3rem;
            color: #f5e5c5;
            text-shadow: 3px 3px 0px #4e342e, 5px 5px 10px rgba(0,0,0,0.7);
            margin: 0;
            line-height: 1;
        }

        /* Iconos de ramas en el título */
        .game-header::before, .game-header::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 70px;
            height: 90px;
            background-size: contain;
            background-repeat: no-repeat;
            transform: translateY(-50%);
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 53 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M 50,95 C 40,80 60,70 50,60 C 40,50 60,40 50,30 C 40,20 60,10 50,5' stroke='%235D4037' stroke-width='8' fill='none' stroke-linecap='round'/%3E%3Cpath d='M 50,60 C 65,55 75,45 80,35' stroke='%235D4037' stroke-width='6' fill='none' stroke-linecap='round'/%3E%3Cpath d='M 50,45 C 35,50 25,60 20,70' stroke='%235D4037' stroke-width='6' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
        }

        .game-header::before {
            left: 0px;
        }

        .game-header::after {
            right: 0px;
            transform: translateY(-50%) scaleX(-1);
        }
        
        .video-wrapper {
            position: relative;
            width: 100%;
            max-width: 900px;
            max-height: calc(100vh - 340px);
            aspect-ratio: 16 / 9;
            overflow: hidden;
            border-radius: 10px;
            background-color: #000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            margin-bottom: 20px;
            border: 4px solid #5D4037; /* Borde de madera */
        }

        .video-wrapper video { 
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        #decision-container {
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            width: 100%;
            max-width: 900px;
            flex-shrink: 0;
        }

        .hidden {
            display: none;
        }
        
        /* Nuevo estilo de botones con ramas */
        .btn {
            position: relative;
            background: #f5e5c5; /* Color pergamino/madera clara */
            color: #5D4037; /* Letras cafés */
            border: 2px solid #4e342e;
            padding: 15px 55px; /* Padding estándar para texto */
            font-size: 16px;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            margin: 25px 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
            display: inline-flex;
            justify-content: center;
            align-items: center;
        }

        .btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 7px 22px rgba(0, 0, 0, 0.6);
            background: #fffbf2;
        }

        /* Ramas decorativas de los botones */
        .btn::before, .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 45px;
            height: 60px;
            background-size: contain;
            background-repeat: no-repeat;
            transform: translateY(-50%);
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 53 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M 50,95 C 40,80 60,70 50,60 C 40,50 60,40 50,30 C 40,20 60,10 50,5' stroke='%235D4037' stroke-width='8' fill='none' stroke-linecap='round'/%3E%3Cpath d='M 50,60 C 65,55 75,45 80,35' stroke='%235D4037' stroke-width='6' fill='none' stroke-linecap='round'/%3E%3Cpath d='M 50,45 C 35,50 25,60 20,70' stroke='%235D4037' stroke-width='6' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
            pointer-events: none;
        }

        .btn::before {
            left: -25px;
        }

        .btn::after {
            right: -25px;
            transform: translateY(-50%) scaleX(-1);
        }

        /* --- ESTILO ESPECÍFICO PARA EL BOTÓN DE SONIDO --- */
        #soundToggle {
            position: absolute;
            bottom: 20px;
            left: 30px; /* Un poco más a la derecha para que la rama no se corte */
            z-index: 10;
            padding: 10px 20px; /* Padding reducido para contener solo el icono */
            min-width: 60px; /* Ancho mínimo para mantener forma */
            height: 50px;
        }
        
        #soundToggle svg {
            width: 28px;
            height: 28px;
            fill: #5D4037; /* Color de la madera oscura */
        }

        #question-text {
            font-size: 24px;
            margin-bottom: 20px;
            color: #ffffff;
            font-weight: 300;
            text-shadow: 2px 2px 5px #000;
        }

        #buttons-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        @media (min-width: 768px) {
            #buttons-container {
                flex-direction: row;
                flex-wrap: wrap;
            }
            .btn {
                font-size: 18px;
            }
        }
        @media (max-width: 768px) {
            .game-header h1 {
                font-size: 2rem;
            }
            .game-header::before, .game-header::after {
                width: 50px;
                height: 70px;
            }
        }
    </style>
</head>
<body>

<div class="game-container">
    
    <header class="game-header">
        <h1>Aventura en el Bosque</h1>
    </header>
    
    <div id="video-container" class="video-wrapper">
        <video id="videoPlayer" src="" autoplay muted playsinline></video>
        
        <!-- Botón de sonido con iconos -->
        <button id="soundToggle" class="btn" title="Activar/Desactivar sonido">
            <!-- El icono se insertará vía JS -->
        </button>
    </div>

    <div id="decision-container" class="hidden">
        <h2 id="question-text"></h2>
        <div id="buttons-container">
        </div>
    </div>
</div>

<script>
    const story = {
        'Aparecebosque': {
            filename: 'escenasfinales/Aparecebosque2.MOV', 
            question: '¿Qué decisión tomas?',
            choices: [
                { text: 'Correr tras un guatín', nextScene: 'Bosqueguatin' },
                { text: 'Bajar fruta de un árbol', nextScene: 'Arboljabali' }
            ]
        },
        'Bosqueguatin': {
            filename: 'escenasfinales/Bosqueguatin.mp4',
            question: '¿Qué decisión tomas?',
            choices: [
                { text: 'Cubrirte con hojas de platano', nextScene: 'Platanooso' },
                { text: 'Construir un refugio', nextScene: 'Refugiocentauro' }
            ]
        },
        'Platanooso': {
            filename: 'escenasfinales/Platanooso2.mp4',
            question: '¿Qué decisión tomas?',
            choices: [
                { text: 'Quedarte quieto', nextScene: 'Quietoosofinal' },
                { text: 'Intentar escapar', nextScene: 'Escapeoso' }
            ]
        },
        'Refugiocentauro': {
            filename: 'escenasfinales/Refugiocentauro3.mp4',
            question: '¿Qué decisión tomas?',
            choices: [
                { text: 'Hablar con el', nextScene: 'Centaurohabla' },
                { text: 'Me hago el muerto para que no me haga nada', nextScene: 'Mehagoelmuerto' }
            ]
        },
        'Arboljabali': {
            filename: 'escenasfinales/Arboljabali2.mp4',
            question: '¿Qué decisión tomas?',
            choices: [
                { text: 'Subir a un árbol', nextScene: 'Arbolduende' },
                { text: 'Correr', nextScene: 'Correrjabali' }
            ]
        },
        'Arbolduende': {
            filename: 'escenasfinales/Arbolduende3.mp4',
            question: '¿Qué decisión tomas?',
            choices: [
                { text: 'Poner una bomba y huír', nextScene: 'Bomba' },
                { text: 'Lo saludo, es amigable', nextScene: 'Duendeamigo' }
            ]
        },
        'Quietoosofinal': {
            filename: 'escenasfinales/quietoosofinal2.mp4',
            isEnd: true
        },
        'Escapeoso': {
            filename: 'escenasfinales/Escapeoso2.mp4',
            isEnd: true
        },
        'Centaurohabla': {
            filename: 'escenasfinales/Centaurohabla2.mp4',
            isEnd: true
        },
        'Mehagoelmuerto': {
            filename: 'escenasfinales/Mehagoelmuerto2.mp4',
            isEnd: true
        },
        'Bomba': {
            filename: 'escenasfinales/bomba2.mp4',
            isEnd: true
        },
        'Duendeamigo': {
            filename: 'escenasfinales/Duendeamigo2.mp4',
            isEnd: true
        },
        'Correrjabali': {
            filename: 'escenasfinales/Correrjabali2.mp4',
            isEnd: true
        }
    };
    
    const videoPlayer = document.getElementById('videoPlayer'); 
    const decisionContainer = document.getElementById('decision-container');
    const questionText = document.getElementById('question-text');
    const buttonsContainer = document.getElementById('buttons-container');
    const soundToggle = document.getElementById('soundToggle');

    // Iconos SVG
    // Icono Bocina Muteada (Muted)
    const iconMuted = `
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73 4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>
    </svg>`;

    // Icono Bocina Activa (Unmuted)
    const iconSound = `
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
    </svg>`;

    function refreshSoundToggle() {
        if (!videoPlayer) return;
        const isMuted = videoPlayer.muted || videoPlayer.volume === 0;
        // Cambiar el contenido HTML del botón por el icono correspondiente
        soundToggle.innerHTML = isMuted ? iconMuted : iconSound;
        soundToggle.classList.remove('hidden');
    }

    function showScene(sceneKey) {
        const scene = story[sceneKey];
        if (!scene) {
            console.error(`Error: La escena "${sceneKey}" no existe en la historia.`);
            return;
        }

        decisionContainer.classList.add('hidden');
        buttonsContainer.innerHTML = ''; 
        
        videoPlayer.onloadeddata = null; 
        videoPlayer.onerror = null; 

        console.log(`Intentando cargar video: ${scene.filename}`);

        videoPlayer.src = scene.filename;

        videoPlayer.load();
        videoPlayer.play().catch(error => {
            console.warn("Autoplay bloqueado.", error);
            refreshSoundToggle();
        });

        videoPlayer.onloadeddata = () => {
             console.log("Video cargado. Mostrando decisiones.");
             showDecisions(scene);
             refreshSoundToggle();
        };

        videoPlayer.onerror = (event) => {
            console.error("ERROR CRÍTICO al cargar el video.", event);
            questionText.textContent = `[ERROR DE VIDEO: No se pudo cargar el archivo. ¿Deseas continuar?] ${scene.question}`;
            showDecisions(scene); 
            videoPlayer.onloadeddata = null; 
            refreshSoundToggle();
        };
    }
    
    function showDecisions(scene) {
        if (scene.isEnd) {
            questionText.textContent = 'Fin de esta ruta. ¿Quieres intentarlo de nuevo?';
            const restartButton = document.createElement('button');
            restartButton.textContent = 'Volver a Empezar';
            restartButton.className = 'btn';
            restartButton.onclick = () => showScene('Aparecebosque');
            buttonsContainer.appendChild(restartButton);
        } else {
            if (!questionText.textContent.includes('[ERROR DE VIDEO')) {
                questionText.textContent = scene.question;
            }
            
            scene.choices.forEach(choice => {
                const button = document.createElement('button');
                button.textContent = choice.text;
                button.className = 'btn';
                button.onclick = () => showScene(choice.nextScene);
                buttonsContainer.appendChild(button);
            });
        }
        
        decisionContainer.classList.remove('hidden');
    }
    
    showScene('Aparecebosque');

    soundToggle.addEventListener('click', () => {
        try {
            if (videoPlayer.muted || videoPlayer.volume === 0) {
                videoPlayer.muted = false;
                videoPlayer.volume = 1;
            } else {
                videoPlayer.muted = true;
            }
            const playPromise = videoPlayer.play();
            if (playPromise && typeof playPromise.then === 'function') {
                playPromise.catch(() => {});
            }
        } catch(e) {
            console.warn('No se pudo reproducir con sonido aún:', e);
        }
        refreshSoundToggle();
    });

    refreshSoundToggle();

</script>

</body>
</html>